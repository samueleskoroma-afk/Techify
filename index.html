<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Download Your Product ‚Äî Techify</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;700;800&display=swap');
    :root{--bg:#080c10;--bg-card:#0f1620;--bg-card2:#141c28;--border:rgba(255,255,255,0.08);--accent:#00d2ff;--green:#00e676;--text:#e8edf5;--text-muted:#7a8aa0;--text-dim:#4a5568;--font-display:'Syne',system-ui,sans-serif;--font-mono:'Space Mono',monospace;--radius:12px;--radius-lg:20px;--transition:0.25s ease}
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:var(--font-display);background:var(--bg);color:var(--text);line-height:1.6;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:2rem}
    a{color:inherit;text-decoration:none}
    .hero-bg{position:fixed;inset:0;z-index:-1}
    .grid-overlay{position:absolute;inset:0;background-image:linear-gradient(rgba(0,210,255,0.03) 1px,transparent 1px),linear-gradient(90deg,rgba(0,210,255,0.03) 1px,transparent 1px);background-size:60px 60px}
    .glow{position:absolute;border-radius:50%;filter:blur(80px)}
    .glow-1{width:500px;height:500px;background:radial-gradient(circle,rgba(0,210,255,0.2),transparent);top:-100px;left:-100px}
    .glow-2{width:400px;height:400px;background:radial-gradient(circle,rgba(0,230,118,0.15),transparent);bottom:-100px;right:-100px}
    canvas{position:fixed;inset:0;pointer-events:none;z-index:10}
    .card{background:var(--bg-card);border:1px solid rgba(0,230,118,0.3);border-radius:var(--radius-lg);padding:3rem 2.5rem;max-width:560px;width:100%;text-align:center;box-shadow:0 0 60px rgba(0,230,118,0.1);position:relative;z-index:20}
    .icon{font-size:5rem;margin-bottom:1.5rem;animation:bounce 1.5s ease infinite alternate;display:block}
    @keyframes bounce{from{transform:translateY(0)}to{transform:translateY(-12px)}}
    h1{font-size:2rem;font-weight:800;margin-bottom:.5rem}
    .subtitle{color:var(--text-muted);margin-bottom:2rem}
    .product-box{background:var(--bg-card2);border:1px solid var(--border);border-radius:var(--radius);padding:1.25rem;margin-bottom:1.5rem;text-align:left;display:flex;align-items:center;gap:1rem}
    .product-emoji{font-size:2.5rem}
    .product-name{font-weight:700;margin-bottom:.25rem}
    .product-meta{font-size:.8rem;color:var(--text-muted)}
    .download-btn{display:block;background:var(--green);color:#000;border-radius:50px;padding:1.1rem 2rem;font-weight:800;font-size:1rem;margin-bottom:1rem;transition:all var(--transition);font-family:var(--font-display);text-decoration:none;border:none;cursor:pointer;width:100%;text-align:center}
    .download-btn:hover{background:#00ff87;transform:translateY(-2px);box-shadow:0 0 30px rgba(0,230,118,0.4)}
    .meta-row{display:flex;justify-content:center;gap:1.5rem;font-size:.82rem;color:var(--text-muted);margin-bottom:1.5rem;flex-wrap:wrap}
    .meta-item{display:flex;align-items:center;gap:.35rem}
    .timer{font-family:var(--font-mono);color:var(--accent);font-size:.95rem;margin-top:.75rem}
    .order-id{font-family:var(--font-mono);font-size:.78rem;color:var(--text-dim);background:rgba(255,255,255,0.04);border:1px solid var(--border);border-radius:8px;padding:.4rem .85rem;display:inline-block;margin:.75rem 0}
    .back-link{color:var(--text-muted);font-size:.85rem;margin-top:1.5rem;display:inline-block;transition:color var(--transition)}
    .back-link:hover{color:var(--accent)}
    .invalid-state{text-align:center;padding:2rem}
    .invalid-state h2{color:#ff5757;margin-bottom:1rem}
  </style>
</head>
<body>
<div class="hero-bg"><div class="grid-overlay"></div><div class="glow glow-1"></div><div class="glow glow-2"></div></div>
<canvas id="confetti"></canvas>

<div class="card" id="downloadCard">
  <span class="icon">üéâ</span>
  <h1>Your Download is Ready!</h1>
  <p class="subtitle">Thank you for your purchase. Your file is ready to download.</p>

  <div class="product-box">
    <div class="product-emoji" id="prodEmoji">üìã</div>
    <div>
      <div class="product-name" id="prodName">Loading...</div>
      <div class="product-meta" id="prodMeta">Preparing your file...</div>
    </div>
  </div>

  <div class="order-id" id="orderId">Order: Loading...</div>

  <div class="meta-row">
    <div class="meta-item">‚¨áÔ∏è <span id="downloadsLeft">3</span> downloads left</div>
    <div class="meta-item">‚è±Ô∏è Expires in <span class="timer" id="timerDisplay">47:59:00</span></div>
  </div>

  <a href="#" class="download-btn" id="downloadBtn" onclick="handleDownload(event)">
    ‚¨áÔ∏è Download Your Product
  </a>

  <p style="font-size:.8rem;color:var(--text-dim)">Save this file to your device. For support, contact us on WhatsApp.</p>

  <a href="products.html" class="back-link">‚Üê Browse More Products</a>
</div>

<div class="card" id="invalidCard" style="display:none">
  <div class="invalid-state">
    <div style="font-size:3rem;margin-bottom:1rem">‚ùå</div>
    <h2>Invalid Download Link</h2>
    <p style="color:var(--text-muted);margin-bottom:1.5rem">This download link is invalid or has expired. Please contact us for help.</p>
    <a href="index.html" style="color:var(--accent)">‚Üê Back to Home</a>
  </div>
</div>

<script>
const PRODUCTS = [
  {id:"prod_001",title:"Winning Business Plan Template",emoji:"üìã",fileType:"DOCX + PDF",fileSize:"2.3 MB"},
  {id:"prod_002",title:"CV & Resume Bundle (5 Templates)",emoji:"üìÑ",fileType:"DOCX + PDF",fileSize:"4.1 MB"},
  {id:"prod_003",title:"Digital Marketing for African Businesses",emoji:"üìò",fileType:"PDF",fileSize:"8.7 MB"},
  {id:"prod_004",title:"Excel & Spreadsheet Mastery Course",emoji:"üìä",fileType:"PDF + XLSX",fileSize:"45 MB"},
  {id:"prod_005",title:"Social Media Content Calendar 2024",emoji:"üìÖ",fileType:"Excel + PDF",fileSize:"3.2 MB"},
  {id:"prod_006",title:"Start & Register a Business in SL",emoji:"üìë",fileType:"PDF",fileSize:"5.5 MB"},
  {id:"prod_007",title:"Invoice & Receipts Template Pack",emoji:"üßæ",fileType:"DOCX + XLSX",fileSize:"1.8 MB"},
  {id:"prod_008",title:"Python Programming for Beginners",emoji:"üêç",fileType:"PDF + Code Files",fileSize:"12 MB"}
];

const params = new URLSearchParams(window.location.search);
const token = params.get('token');
const orderId = params.get('order');

let downloadsLeft = 3;

// Try to find the order
const orders = JSON.parse(localStorage.getItem('techify_orders')||'[]');
const order = orders.find(o=>o.id===orderId && o.token===token);

if(order || (token && orderId)){
  // Valid (or demo mode - show content even if order not found)
  const prod = order ? PRODUCTS.find(p=>p.id===order.productId)||PRODUCTS[0] : PRODUCTS[0];
  document.getElementById('prodEmoji').textContent = prod.emoji;
  document.getElementById('prodName').textContent = order ? order.productTitle : prod.title;
  document.getElementById('prodMeta').textContent = prod.fileType + ' ¬∑ ' + prod.fileSize;
  document.getElementById('orderId').textContent = 'üîñ Order: ' + (orderId || 'DEMO-ORDER');
  
  if(order){
    downloadsLeft = 3 - (order.downloadCount||0);
    document.getElementById('downloadsLeft').textContent = downloadsLeft;
  }
  
  // Countdown timer (48 hours)
  let seconds = 48 * 3600;
  function updateTimer(){
    const h = Math.floor(seconds/3600);
    const m = Math.floor((seconds%3600)/60);
    const s = seconds%60;
    document.getElementById('timerDisplay').textContent = `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    if(seconds > 0) seconds--;
  }
  updateTimer();
  setInterval(updateTimer, 1000);
  
  // Confetti
  launchConfetti();
} else {
  document.getElementById('downloadCard').style.display='none';
  document.getElementById('invalidCard').style.display='block';
}

function handleDownload(e){
  e.preventDefault();
  if(downloadsLeft <= 0){
    alert('You have used all your download attempts. Contact us for help.');
    return;
  }
  downloadsLeft--;
  document.getElementById('downloadsLeft').textContent = downloadsLeft;
  
  // Update order download count
  if(order){
    const orders2 = JSON.parse(localStorage.getItem('techify_orders')||'[]');
    const idx = orders2.findIndex(o=>o.id===orderId);
    if(idx!==-1){orders2[idx].downloadCount=(orders2[idx].downloadCount||0)+1;localStorage.setItem('techify_orders',JSON.stringify(orders2))}
  }
  
  // In demo: show message. In production: download the actual file.
  alert('üìÅ In a live version, your file would download now!\n\nFor this demo, place your product files in the /downloads/ folder and configure the downloadFile field in your products list.');
}

// Confetti animation
function launchConfetti(){
  const canvas = document.getElementById('confetti');
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  
  const pieces = Array.from({length:120},()=>({
    x:Math.random()*canvas.width,
    y:Math.random()*canvas.height-canvas.height,
    w:8+Math.random()*8,
    h:4+Math.random()*4,
    color:['#00d2ff','#00e676','#ff6b2b','#ffd700','#ff5757','#a78bfa'][Math.floor(Math.random()*6)],
    speed:2+Math.random()*4,
    spin:Math.random()*0.2-0.1,
    angle:Math.random()*Math.PI*2
  }));
  
  let frame = 0;
  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    pieces.forEach(p=>{
      ctx.save();
      ctx.translate(p.x,p.y);
      ctx.rotate(p.angle);
      ctx.fillStyle=p.color;
      ctx.globalAlpha=0.8;
      ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);
      ctx.restore();
      p.y+=p.speed;
      p.angle+=p.spin;
      if(p.y>canvas.height+20){p.y=-20;p.x=Math.random()*canvas.width}
    });
    frame++;
    if(frame<300) requestAnimationFrame(draw);
    else ctx.clearRect(0,0,canvas.width,canvas.height);
  }
  draw();
}
</script>
</body>
</html>
